<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Ricardo de Oliveira Perdiz" />

<meta name="date" content="2018-10-17" />

<title>NIRtools</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">NIRtools</h1>
<h4 class="author"><em>Ricardo de Oliveira Perdiz</em></h4>
<h4 class="date"><em>2018-10-17</em></h4>



<div id="overview" class="section level1">
<h1>Overview</h1>
<p>NIRTools was specifically designed to help plant taxonomist and ecologists in documenting and building NIR spectra datasets from a source in an easy way.</p>
<div id="what-is-nir" class="section level2">
<h2>What is NIR?</h2>
<p>To be constructed.</p>
</div>
</div>
<div id="installation" class="section level1">
<h1>Installation</h1>
<!-- You can install NIRtools by using `devtools::install_github()` function. -->
<p>To be constructed.</p>
</div>
<div id="quick-start" class="section level1">
<h1>Quick start</h1>
<p>Let’s take a look at our example dataset and use it to build our first subset.</p>
<p>First, load the package and check the first rows of it.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">head</span>(nir_data)[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##    especimenid SP1    read    face X10001.03  X3999.64 X4003.497 X4007.354
## 1:          17   4 folha-1 abaxial 0.2778664 0.6532890 0.6533827 0.6532058
## 2:          17   4 folha-1 adaxial 0.2327851 0.6699212 0.6699399 0.6695617
## 3:          17   4 folha-2 abaxial 0.2567553 0.6419270 0.6419497 0.6416439
## 4:          17   4 folha-2 adaxial 0.2555278 0.6343970 0.6343604 0.6339911
## 5:          17   4 folha-3 abaxial 0.2547329 0.6351578 0.6353651 0.6350956
## 6:          17   4 folha-3 adaxial 0.2304880 0.6802652 0.6802475 0.6799131
##    X4011.211 X4015.068
## 1: 0.6527848 0.6518375
## 2: 0.6689490 0.6678685
## 3: 0.6412423 0.6403816
## 4: 0.6335653 0.6326041
## 5: 0.6345941 0.6338017
## 6: 0.6793467 0.6782958</code></pre>
<p>We have a column <code>especimenid</code> that specifies the sample id number, a columm <code>SP1</code> that specifies our sample identity (in this case, it is the number of the species, a hypothetical number); a column <code>read</code> that specifies the leaf/leaflet id, that is, for each leaf/leaflet, we have a different value; a column <code>face</code> that specifies which surface was used to obtain the data; and at least, a group of columns that starts with letter <em>X</em> and that refer to NIR spectra.</p>
<p>There are samples that have more than one read per surface. So, suppose we want to create a subset that contains only read means for both surfaces and containing all NIR spectra variables, that is, for each specimen, we would calculate mean for all reads per surface per NIR spectra variable. Our first step would be to create a parameter file that will contain all specifications of it. Let’s use the function <code>write_NIRparams</code>.</p>
<p>In this example, my first subset will be called <code>test</code>, and I will use mean of reads, only abaxial surface, and I will inform which column names refer to surface(<code>face</code>), individual (<code>especimenid</code>), and species/group (<code>SP1</code>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">write_NIRparams</span>(</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">file =</span> <span class="st">&#39;test&#39;</span>,</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">wd =</span> <span class="kw">getwd</span>(),</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">reads =</span> <span class="st">&#39;mean&#39;</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">surface =</span> <span class="st">&#39;abaxial&#39;</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="dt">nir_variables =</span> <span class="st">&#39;all&#39;</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="dt">surface_id =</span> <span class="st">&#39;face&#39;</span>,</a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="dt">individual_id =</span> <span class="st">&#39;especimenid&#39;</span>,</a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="dt">group_id =</span> <span class="st">&#39;SP1&#39;</span>,</a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="dt">nir_id =</span> <span class="st">&#39;X&#39;</span>)</a></code></pre></div>
<p>After executing the function, a message will appear confirming the action and telling where the file has been saved.</p>
<p>Let’s take a look at this file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">readLines</span>(<span class="st">&#39;test-NIR.txt&#39;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;# NIR dataset description - Dataset name and variables for its construction&quot;                                                                                                       
##  [2] &quot;test ## [dataset_name]: Dataset name.&quot;                                                                                                                                             
##  [3] &quot;/Users/ricoperdiz/Documents/DOC/PROJETO_DOC/R/pkgs/NIRtools/vignettes ## [working_dir]: Location of working directory. If not provided, current working directory will be used one&quot;
##  [4] &quot;abaxial ## [surface]: Which leaf surface (abaxial, adaxial, both)&quot;                                                                                                                 
##  [5] &quot;mean ## [reads]: Do all the reads will be taken into account (all, mean)?&quot;                                                                                                         
##  [6] &quot;all ## [nir_variables]: Which NIR variables will be used (all, subset)&quot;                                                                                                            
##  [7] &quot;           ## [subset_file]: Location of NIR variable subset file, in case option selected in `nir_variables` was `subset`&quot;                                                        
##  [8] &quot;especimenid ## [individual_id]: Which variable name corresponds to the individual?&quot;                                                                                                
##  [9] &quot;face ## [surface_id]: Which variable name corresponds to the leaf surface?&quot;                                                                                                        
## [10] &quot;SP1 ## [group_id]: Which name corresponds to the group category?&quot;                                                                                                                  
## [11] &quot;X ## [nir_id]: A string that can be used to grep column names containing NIR data. Default value is &#39;`X`, which precedes all columns with NIR data.&quot;</code></pre>
<p>After having our parameter file specification done, you can use function <code>read_NIRparams</code> to have your parameter file read as a dataframe.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">read_NIRparams</span>(<span class="st">&#39;test-NIR.txt&#39;</span>)</a></code></pre></div>
<p>At last, let’s use the parameter file to build a subset based on our data file. For that, let’s use function <code>build_NIRdataset</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">subset01 &lt;-<span class="st"> </span><span class="kw">build_NIRdataset</span>(<span class="dt">df =</span> nir_data, <span class="dt">params_file =</span> <span class="st">&#39;test-NIR.txt&#39;</span>, <span class="dt">wd =</span> <span class="st">&#39;.&#39;</span>)</a></code></pre></div>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: abaxial side</code></pre>
<pre><code>## Variable `reads`: mean</code></pre>
<pre><code>## Building dataset: test.
## Mean of reads from both sides grouped by variable `especimenid`</code></pre>
<p>Note that you can also choose to save a RDS and/or a txt file with this subset, you just need to choose <code>TRUE</code> instead of the default option <code>FALSE</code>.</p>
<p>Let’s check our subset01.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">head</span>(subset01)[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##    especimenid X10001.03  X3999.64 X4003.497 X4007.354 X4011.211 X4015.068
## 1:           1 0.2726848 0.5870106 0.5873088 0.5872404 0.5871257 0.5866435
## 2:           2 0.2669050 0.6696110 0.6696059 0.6692295 0.6688587 0.6681104
## 3:           3 0.2676881 0.6619618 0.6620807 0.6618708 0.6614516 0.6606935
## 4:           4 0.2482224 0.6593646 0.6593484 0.6591898 0.6588389 0.6581174
## 5:           5 0.2880839 0.6449743 0.6449506 0.6447369 0.6445321 0.6439594
## 6:           6 0.2572176 0.6149731 0.6151043 0.6149442 0.6147412 0.6141836
##    X4018.925 X4022.781 X4026.638
## 1: 0.5857780 0.5845048 0.5829656
## 2: 0.6668576 0.6653342 0.6635179
## 3: 0.6596471 0.6580762 0.6561215
## 4: 0.6571161 0.6554641 0.6534191
## 5: 0.6429325 0.6415167 0.6399324
## 6: 0.6133114 0.6119306 0.6102560</code></pre>
</div>
<div id="tutorial" class="section level1">
<h1>Tutorial</h1>
<p>After our brief quick start, let’s take a deeper look at NIRtools functionality.</p>
<p>Suppose you want to build many subsets at once, with different combinations of values for reads and surfaces.</p>
<p>In this example, I will make use of a few packages of <a href="https://www.tidyverse.org/">tidyverse</a>. I suggest you to learn how to use these packages because they are easy to manipulate and make reading R code easier.</p>
<div id="using-parameter-file" class="section level2">
<h2>Using parameter file</h2>
<p>First, let’s create a vector of subset names.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5">subset_names &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&#39;subset%02d&#39;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb14-6" title="6">surface_values &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;abaxial&#39;</span>, <span class="st">&#39;adaxial&#39;</span>, <span class="st">&#39;both&#39;</span>)</a>
<a class="sourceLine" id="cb14-7" title="7">surface_id &lt;-<span class="st"> &#39;face&#39;</span></a>
<a class="sourceLine" id="cb14-8" title="8">reads_values &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;all&#39;</span>, <span class="st">&#39;all&#39;</span>, <span class="st">&#39;mean&#39;</span>)</a>
<a class="sourceLine" id="cb14-9" title="9">individual_id &lt;-<span class="st"> &#39;especimenid&#39;</span></a>
<a class="sourceLine" id="cb14-10" title="10">group_id &lt;-<span class="st"> &#39;SP1&#39;</span></a>
<a class="sourceLine" id="cb14-11" title="11">nir_id &lt;-<span class="st"> &#39;X&#39;</span></a>
<a class="sourceLine" id="cb14-12" title="12"></a>
<a class="sourceLine" id="cb14-13" title="13">metadata &lt;-<span class="st"> </span><span class="kw">data_frame</span>(subset_names, surface_values, reads_values, individual_id, surface_id, group_id, nir_id)</a></code></pre></div>
<p>Now, let’s create several parameter files at once, using all columns from our object <code>metadata</code>. Each one of its columns, as you can see above, contain all necessary data to create our parameter files.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">pwalk</span>(<span class="kw">list</span>(subset_names, surface_values, reads_values, individual_id, surface_id, group_id, nir_id), <span class="op">~</span><span class="kw">write_NIRparams</span>(<span class="dt">file =</span> ..<span class="dv">1</span>, <span class="dt">wd =</span> <span class="st">&#39;.&#39;</span>, <span class="dt">surface =</span> ..<span class="dv">2</span>, <span class="dt">reads =</span> ..<span class="dv">3</span>, <span class="dt">individual_id =</span> ..<span class="dv">4</span>, <span class="dt">surface_id =</span> ..<span class="dv">5</span>, <span class="dt">group_id =</span> ..<span class="dv">6</span>, <span class="dt">nir_id =</span> ..<span class="dv">7</span>))</a></code></pre></div>
<p>The function <code>purrr::pwalk</code> takes a list of arguments and uses them as input for function ~NIRtools::write_NIRparams` whose result is having our three parameter files saved in our current working directory.</p>
<div id="building-subsets-one-by-one" class="section level3">
<h3>Building subsets one by one</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">subset_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&#39;subset&#39;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co"># subset 01</span></a>
<a class="sourceLine" id="cb16-3" title="3">subset01 &lt;-<span class="st"> </span><span class="kw">build_NIRdataset</span>(nir_data, subset_files[<span class="dv">1</span>])</a></code></pre></div>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: abaxial side</code></pre>
<pre><code>## Variable `reads`: all</code></pre>
<pre><code>## Building dataset: subset01.
## All reads from abaxial side grouped by variable `especimenid`</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># subset 02</span></a>
<a class="sourceLine" id="cb21-2" title="2">subset02 &lt;-<span class="st"> </span><span class="kw">build_NIRdataset</span>(nir_data, subset_files[<span class="dv">2</span>])</a></code></pre></div>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: adaxial side</code></pre>
<pre><code>## Variable `reads`: all</code></pre>
<pre><code>## Building dataset: subset02.
## All reads from adaxial side grouped by variable `especimenid`</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="co"># subset 03</span></a>
<a class="sourceLine" id="cb26-2" title="2">subset03 &lt;-<span class="st"> </span><span class="kw">build_NIRdataset</span>(nir_data, subset_files[<span class="dv">3</span>])</a></code></pre></div>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: both sides</code></pre>
<pre><code>## Variable `reads`: mean</code></pre>
<pre><code>## Building dataset: subset03.
## Mean of reads from both sides grouped by variable `especimenid`</code></pre>
<p>Let’s have a look at them.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">dim</span>(subset01)</a></code></pre></div>
<pre><code>## [1]  270 1559</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">dim</span>(subset02)</a></code></pre></div>
<pre><code>## [1]  271 1559</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">dim</span>(subset03)</a></code></pre></div>
<pre><code>## [1]   74 1558</code></pre>
<p>What if I do not remember which dataset refers to what? You have your parameter files to check. For example, what does subset03 mean?</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">readLines</span>(<span class="st">&#39;subset03-NIR.txt&#39;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;# NIR dataset description - Dataset name and variables for its construction&quot;                                                                                                       
##  [2] &quot;subset03 ## [dataset_name]: Dataset name.&quot;                                                                                                                                         
##  [3] &quot;/Users/ricoperdiz/Documents/DOC/PROJETO_DOC/R/pkgs/NIRtools/vignettes ## [working_dir]: Location of working directory. If not provided, current working directory will be used one&quot;
##  [4] &quot;both ## [surface]: Which leaf surface (abaxial, adaxial, both)&quot;                                                                                                                    
##  [5] &quot;mean ## [reads]: Do all the reads will be taken into account (all, mean)?&quot;                                                                                                         
##  [6] &quot;           ## [nir_variables]: Which NIR variables will be used (all, subset)&quot;                                                                                                     
##  [7] &quot;           ## [subset_file]: Location of NIR variable subset file, in case option selected in `nir_variables` was `subset`&quot;                                                        
##  [8] &quot;especimenid ## [individual_id]: Which variable name corresponds to the individual?&quot;                                                                                                
##  [9] &quot;face ## [surface_id]: Which variable name corresponds to the leaf surface?&quot;                                                                                                        
## [10] &quot;SP1 ## [group_id]: Which name corresponds to the group category?&quot;                                                                                                                  
## [11] &quot;X ## [nir_id]: A string that can be used to grep column names containing NIR data. Default value is &#39;`X`, which precedes all columns with NIR data.&quot;</code></pre>
<p>Or let’s have it as a dataframe.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">read_NIRparams</span>(<span class="st">&#39;subset03-NIR.txt&#39;</span>)</a></code></pre></div>
<pre><code>##    dataset_index dataset_name group_id individual_id nir_id nir_variables
## 1:             1     subset03      SP1   especimenid      X              
##    reads subset_file surface surface_id
## 1:  mean                both       face
##                                                              working_dir
## 1: /Users/ricoperdiz/Documents/DOC/PROJETO_DOC/R/pkgs/NIRtools/vignettes</code></pre>
</div>
<div id="building-subsets-all-at-once" class="section level3">
<h3>Building subsets all at once</h3>
<p>Now, let’s use the parameter files to build all our subsets at once.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">subsets &lt;-<span class="st"> </span><span class="kw">walk2</span>(<span class="kw">list</span>(nir_data), subset_files, <span class="op">~</span><span class="kw">build_NIRdataset</span>(<span class="dt">df =</span> .x, .y))</a></code></pre></div>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: abaxial side</code></pre>
<pre><code>## Variable `reads`: all</code></pre>
<pre><code>## Building dataset: subset01.
## All reads from abaxial side grouped by variable `especimenid`</code></pre>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: adaxial side</code></pre>
<pre><code>## Variable `reads`: all</code></pre>
<pre><code>## Building dataset: subset02.
## All reads from adaxial side grouped by variable `especimenid`</code></pre>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: both sides</code></pre>
<pre><code>## Variable `reads`: mean</code></pre>
<pre><code>## Building dataset: subset03.
## Mean of reads from both sides grouped by variable `especimenid`</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">subsets <span class="op">%&gt;%</span><span class="st"> </span>str</a></code></pre></div>
<pre><code>## List of 1
##  $ :Classes &#39;data.table&#39; and &#39;data.frame&#39;:   541 obs. of  1561 variables:
##   ..$ especimenid: num [1:541] 17 17 17 17 17 17 18 18 18 18 ...
##   ..$ SP1        : num [1:541] 4 4 4 4 4 4 8 8 8 8 ...
##   ..$ read       : chr [1:541] &quot;folha-1&quot; &quot;folha-1&quot; &quot;folha-2&quot; &quot;folha-2&quot; ...
##   ..$ face       : chr [1:541] &quot;abaxial&quot; &quot;adaxial&quot; &quot;abaxial&quot; &quot;adaxial&quot; ...
##   ..$ X10001.03  : num [1:541] 0.278 0.233 0.257 0.256 0.255 ...
##   ..$ X3999.64   : num [1:541] 0.653 0.67 0.642 0.634 0.635 ...
##   ..$ X4003.497  : num [1:541] 0.653 0.67 0.642 0.634 0.635 ...
##   ..$ X4007.354  : num [1:541] 0.653 0.67 0.642 0.634 0.635 ...
##   ..$ X4011.211  : num [1:541] 0.653 0.669 0.641 0.634 0.635 ...
##   ..$ X4015.068  : num [1:541] 0.652 0.668 0.64 0.633 0.634 ...
##   ..$ X4018.925  : num [1:541] 0.651 0.667 0.639 0.631 0.633 ...
##   ..$ X4022.781  : num [1:541] 0.649 0.664 0.637 0.629 0.631 ...
##   ..$ X4026.638  : num [1:541] 0.647 0.662 0.635 0.627 0.629 ...
##   ..$ X4030.495  : num [1:541] 0.644 0.659 0.632 0.625 0.626 ...
##   ..$ X4034.352  : num [1:541] 0.642 0.656 0.629 0.622 0.623 ...
##   ..$ X4038.209  : num [1:541] 0.638 0.653 0.626 0.619 0.62 ...
##   ..$ X4042.066  : num [1:541] 0.635 0.649 0.623 0.615 0.617 ...
##   ..$ X4045.923  : num [1:541] 0.632 0.645 0.619 0.612 0.613 ...
##   ..$ X4049.78   : num [1:541] 0.628 0.641 0.616 0.608 0.61 ...
##   ..$ X4053.637  : num [1:541] 0.625 0.637 0.612 0.604 0.606 ...
##   ..$ X4057.494  : num [1:541] 0.621 0.633 0.608 0.6 0.603 ...
##   ..$ X4061.351  : num [1:541] 0.617 0.629 0.604 0.596 0.599 ...
##   ..$ X4065.208  : num [1:541] 0.613 0.624 0.6 0.592 0.594 ...
##   ..$ X4069.065  : num [1:541] 0.609 0.619 0.595 0.588 0.59 ...
##   ..$ X4072.922  : num [1:541] 0.605 0.614 0.591 0.583 0.586 ...
##   ..$ X4076.779  : num [1:541] 0.601 0.609 0.587 0.579 0.581 ...
##   ..$ X4080.635  : num [1:541] 0.597 0.604 0.582 0.575 0.577 ...
##   ..$ X4084.492  : num [1:541] 0.593 0.599 0.578 0.571 0.573 ...
##   ..$ X4088.349  : num [1:541] 0.588 0.594 0.574 0.566 0.569 ...
##   ..$ X4092.206  : num [1:541] 0.585 0.59 0.57 0.563 0.565 ...
##   ..$ X4096.063  : num [1:541] 0.581 0.585 0.566 0.559 0.561 ...
##   ..$ X4099.92   : num [1:541] 0.577 0.581 0.562 0.555 0.557 ...
##   ..$ X4103.777  : num [1:541] 0.574 0.576 0.558 0.551 0.554 ...
##   ..$ X4107.634  : num [1:541] 0.57 0.572 0.555 0.547 0.55 ...
##   ..$ X4111.491  : num [1:541] 0.567 0.568 0.552 0.544 0.547 ...
##   ..$ X4115.348  : num [1:541] 0.564 0.565 0.549 0.541 0.544 ...
##   ..$ X4119.205  : num [1:541] 0.561 0.561 0.546 0.538 0.541 ...
##   ..$ X4123.062  : num [1:541] 0.558 0.558 0.543 0.535 0.538 ...
##   ..$ X4126.918  : num [1:541] 0.555 0.555 0.54 0.532 0.535 ...
##   ..$ X4130.775  : num [1:541] 0.553 0.552 0.537 0.53 0.533 ...
##   ..$ X4134.632  : num [1:541] 0.551 0.549 0.535 0.528 0.531 ...
##   ..$ X4138.489  : num [1:541] 0.549 0.547 0.533 0.526 0.529 ...
##   ..$ X4142.346  : num [1:541] 0.547 0.545 0.531 0.524 0.527 ...
##   ..$ X4146.203  : num [1:541] 0.545 0.543 0.53 0.522 0.525 ...
##   ..$ X4150.06   : num [1:541] 0.544 0.541 0.528 0.521 0.524 ...
##   ..$ X4153.917  : num [1:541] 0.543 0.54 0.527 0.52 0.522 ...
##   ..$ X4157.774  : num [1:541] 0.542 0.539 0.526 0.518 0.521 ...
##   ..$ X4161.631  : num [1:541] 0.541 0.538 0.525 0.518 0.521 ...
##   ..$ X4165.488  : num [1:541] 0.54 0.537 0.524 0.517 0.52 ...
##   ..$ X4169.345  : num [1:541] 0.54 0.537 0.524 0.517 0.52 ...
##   ..$ X4173.202  : num [1:541] 0.54 0.536 0.524 0.517 0.52 ...
##   ..$ X4177.059  : num [1:541] 0.54 0.536 0.524 0.517 0.52 ...
##   ..$ X4180.916  : num [1:541] 0.54 0.536 0.524 0.517 0.52 ...
##   ..$ X4184.772  : num [1:541] 0.54 0.536 0.524 0.517 0.52 ...
##   ..$ X4188.629  : num [1:541] 0.54 0.535 0.524 0.516 0.519 ...
##   ..$ X4192.486  : num [1:541] 0.539 0.535 0.524 0.516 0.519 ...
##   ..$ X4196.343  : num [1:541] 0.539 0.535 0.523 0.516 0.519 ...
##   ..$ X4200.2    : num [1:541] 0.539 0.534 0.523 0.516 0.519 ...
##   ..$ X4204.057  : num [1:541] 0.539 0.534 0.523 0.515 0.519 ...
##   ..$ X4207.914  : num [1:541] 0.539 0.534 0.523 0.515 0.519 ...
##   ..$ X4211.771  : num [1:541] 0.539 0.534 0.523 0.515 0.518 ...
##   ..$ X4215.628  : num [1:541] 0.539 0.534 0.523 0.515 0.518 ...
##   ..$ X4219.485  : num [1:541] 0.539 0.534 0.523 0.515 0.518 ...
##   ..$ X4223.342  : num [1:541] 0.539 0.535 0.523 0.515 0.519 ...
##   ..$ X4227.199  : num [1:541] 0.539 0.535 0.523 0.515 0.519 ...
##   ..$ X4231.056  : num [1:541] 0.539 0.536 0.523 0.516 0.519 ...
##   ..$ X4234.913  : num [1:541] 0.539 0.536 0.524 0.516 0.519 ...
##   ..$ X4238.77   : num [1:541] 0.54 0.537 0.524 0.516 0.52 ...
##   ..$ X4242.626  : num [1:541] 0.54 0.538 0.525 0.517 0.52 ...
##   ..$ X4246.483  : num [1:541] 0.541 0.539 0.525 0.518 0.521 ...
##   ..$ X4250.34   : num [1:541] 0.542 0.54 0.526 0.518 0.522 ...
##   ..$ X4254.197  : num [1:541] 0.542 0.54 0.526 0.519 0.522 ...
##   ..$ X4258.054  : num [1:541] 0.542 0.54 0.526 0.519 0.522 ...
##   ..$ X4261.911  : num [1:541] 0.542 0.54 0.526 0.518 0.522 ...
##   ..$ X4265.768  : num [1:541] 0.542 0.539 0.526 0.518 0.522 ...
##   ..$ X4269.625  : num [1:541] 0.541 0.539 0.526 0.518 0.522 ...
##   ..$ X4273.482  : num [1:541] 0.541 0.538 0.525 0.517 0.521 ...
##   ..$ X4277.339  : num [1:541] 0.54 0.537 0.525 0.517 0.521 ...
##   ..$ X4281.196  : num [1:541] 0.54 0.536 0.524 0.516 0.52 ...
##   ..$ X4285.053  : num [1:541] 0.539 0.536 0.523 0.515 0.519 ...
##   ..$ X4288.91   : num [1:541] 0.539 0.535 0.522 0.515 0.519 ...
##   ..$ X4292.767  : num [1:541] 0.538 0.534 0.522 0.514 0.518 ...
##   ..$ X4296.624  : num [1:541] 0.537 0.533 0.521 0.513 0.517 ...
##   ..$ X4300.48   : num [1:541] 0.536 0.533 0.52 0.512 0.516 ...
##   ..$ X4304.337  : num [1:541] 0.535 0.532 0.519 0.512 0.516 ...
##   ..$ X4308.194  : num [1:541] 0.535 0.532 0.519 0.511 0.515 ...
##   ..$ X4312.051  : num [1:541] 0.534 0.532 0.518 0.51 0.515 ...
##   ..$ X4315.908  : num [1:541] 0.534 0.532 0.518 0.51 0.515 ...
##   ..$ X4319.765  : num [1:541] 0.534 0.533 0.518 0.51 0.515 ...
##   ..$ X4323.622  : num [1:541] 0.534 0.533 0.518 0.51 0.515 ...
##   ..$ X4327.479  : num [1:541] 0.533 0.532 0.517 0.509 0.513 ...
##   ..$ X4331.336  : num [1:541] 0.532 0.531 0.516 0.508 0.512 ...
##   ..$ X4335.193  : num [1:541] 0.531 0.53 0.515 0.507 0.511 ...
##   ..$ X4339.05   : num [1:541] 0.53 0.528 0.513 0.506 0.51 ...
##   ..$ X4342.907  : num [1:541] 0.528 0.527 0.512 0.504 0.509 ...
##   ..$ X4346.764  : num [1:541] 0.527 0.525 0.511 0.503 0.507 ...
##   ..$ X4350.621  : num [1:541] 0.526 0.523 0.509 0.501 0.506 ...
##   ..$ X4354.478  : num [1:541] 0.524 0.521 0.508 0.5 0.505 ...
##   ..$ X4358.334  : num [1:541] 0.523 0.519 0.507 0.499 0.503 ...
##   .. [list output truncated]
##   ..- attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>The result of using function <code>walk2</code> is a list of dataframes, each one with the desired subset.</p>
<p>Another option, and easier to deal with, in my opinion, would be to have our parameter files stored as a dataframe, and then create a column in it that would contain our subsets. Let’s take a look below to see how it is done.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">nir_params &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(subset_files, read_NIRparams)</a></code></pre></div>
<p>At last, let’s have some magic. Let’s create a column called <code>data</code> in <code>nir_params</code> and inside this column, we will store our subset in it. This is called a nested dataframe.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1">nested_df &lt;-</a>
<a class="sourceLine" id="cb57-2" title="2"><span class="st">  </span>nir_params <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb57-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb57-4" title="4">    <span class="dt">main_dataset =</span> <span class="kw">list</span>(nir_data),</a>
<a class="sourceLine" id="cb57-5" title="5">    <span class="dt">data =</span> <span class="kw">map2</span>(main_dataset, subset_files, <span class="op">~</span><span class="kw">build_NIRdataset</span>(<span class="dt">df =</span> .x, .y))</a>
<a class="sourceLine" id="cb57-6" title="6">  )</a></code></pre></div>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: abaxial side</code></pre>
<pre><code>## Variable `reads`: all</code></pre>
<pre><code>## Building dataset: subset01.
## All reads from abaxial side grouped by variable `especimenid`</code></pre>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: adaxial side</code></pre>
<pre><code>## Variable `reads`: all</code></pre>
<pre><code>## Building dataset: subset02.
## All reads from adaxial side grouped by variable `especimenid`</code></pre>
<pre><code>## Variable `surface_id`: face</code></pre>
<pre><code>## Which `surface` was chosen: both sides</code></pre>
<pre><code>## Variable `reads`: mean</code></pre>
<pre><code>## Building dataset: subset03.
## Mean of reads from both sides grouped by variable `especimenid`</code></pre>
<p>Let’s check our nested dataframe.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="co"># subset 01</span></a>
<a class="sourceLine" id="cb70-2" title="2"><span class="kw">dim</span>(nested_df<span class="op">$</span>data[[<span class="dv">1</span>]])</a></code></pre></div>
<pre><code>## [1]  270 1559</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1"><span class="co"># subset 02</span></a>
<a class="sourceLine" id="cb72-2" title="2"><span class="kw">dim</span>(nested_df<span class="op">$</span>data[[<span class="dv">2</span>]])</a></code></pre></div>
<pre><code>## [1]  271 1559</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1"><span class="co"># subset 03</span></a>
<a class="sourceLine" id="cb74-2" title="2"><span class="kw">dim</span>(nested_df<span class="op">$</span>data[[<span class="dv">3</span>]])</a></code></pre></div>
<pre><code>## [1]   74 1558</code></pre>
<p>Notice that the values are exacly as the ones shown by the objects <code>subset01</code>, <code>subset02</code>, and <code>subset03</code>.</p>
</div>
</div>
<div id="using-a-dataframe-containing-parameter-specification" class="section level2">
<h2>Using a dataframe containing parameter specification</h2>
<p>In construction.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
